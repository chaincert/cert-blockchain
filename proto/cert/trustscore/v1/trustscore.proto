syntax = "proto3";
package cert.trustscore.v1;

option go_package = "github.com/chaincertify/certd/x/trustscore/types";

// TrustScoreConfig defines the weighting parameters for trust score calculation
// Per Whitepaper v3.0: Deterministic, Hard to Game, Transparent
message TrustScoreConfig {
  // Device Trust Score Weights (total = 100)
  uint64 tee_attestation_weight     = 1; // 40% - Pass/Fail critical
  uint64 uptime_weight              = 2; // 25% - Rolling 7-day average
  uint64 data_congruence_weight     = 3; // 20% - Statistical deviation from neighbors
  uint64 firmware_integrity_weight  = 4; // 15% - Latest signed firmware bonus

  // Humanity Score Weights (total = 100)
  uint64 hardware_anchor_weight     = 5; // 40% - Linked to high-trust device
  uint64 social_staking_weight      = 6; // 30% - Verified social accounts
  uint64 on_chain_history_weight    = 7; // 20% - Account age + tx history
  uint64 network_fees_paid_weight   = 8; // 10% - Burned $CERT/ETH fees

  // Thresholds
  uint64 verified_humanity_threshold = 9;  // 60 - Minimum for "Verified Human"
  uint64 high_trust_device_threshold = 10; // 80 - Device qualifies for Hardware Anchor
  uint64 data_congruence_audit_days  = 11; // 3 - Days of <50% before audit flag
}

// DeviceTrustFactors contains the inputs for device trust calculation
message DeviceTrustFactors {
  bool   tee_attestation_valid            = 1;
  double uptime                           = 2; // 0.0 to 1.0
  double data_congruence                  = 3; // 0.0 to 1.0
  int32  firmware_version                 = 4;
  int32  consecutive_low_congruence_days  = 5;
}

// DeviceTrustResult contains the calculated device trust score and status
message DeviceTrustResult {
  uint64 score             = 1;
  bool   tee_passed        = 2;
  uint64 uptime_points     = 3;
  uint64 congruence_points = 4;
  uint64 firmware_points   = 5;
  bool   flagged_for_audit = 6;
  bool   banned            = 7;
}

// HumanityFactors contains the inputs for humanity score calculation
message HumanityFactors {
  uint64 linked_device_score           = 1;
  uint64 linked_device_shared_accounts = 2;
  int32  verified_social_accounts      = 3;
  int32  account_age_months            = 4;
  int32  transaction_count             = 5;
  double total_fees_burned_usd         = 6;
}

// HumanityResult contains the calculated humanity score and verification status
message HumanityResult {
  uint64 score             = 1;
  uint64 hardware_points   = 2;
  uint64 social_points     = 3;
  uint64 on_chain_points   = 4;
  uint64 fee_points        = 5;
  bool   is_verified_human = 6;
  double sybil_multiplier  = 7; // 1.0 = no split, 0.2 = 5-way split
}

// QueryScoreRequest is the request to query a trust score
message QueryScoreRequest {
  string address = 1;
}

// QueryScoreResponse is the response containing trust score data
message QueryScoreResponse {
  string          address         = 1;
  HumanityResult  humanity_result = 2;
  uint64          device_count    = 3;
}
